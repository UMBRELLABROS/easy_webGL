<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Kamera mit Math.js</title>
    <link href="css/style.css" rel="stylesheet" />
    <script src="js/gl.js"></script>
    <script src="js/geometry.js"></script>
    <script src="js/physics.js"></script>
    <script src="js/math.js"></script>
    <script src="js/functions.js"></script>
    <script src="js/attribute.js"></script>
    <script src="js/uniform.js"></script>
    <script src="js/texture.js"></script>
    <script src="js/program.js"></script>
    <script src="js/baseobject.js"></script>
    <script src="js/triangle.js"></script>
    <script src="js/dynamic.js"></script>
    <script src="js/item.js"></script>
    <script src="js/scene.js"></script>
    <script src="js/vertexshader.js"></script>
    <script src="js/fragmentshader.js"></script>
    <script src="js/world.js"></script>
    <script src="js/prop.js"></script>
    <script src="js/light.js"></script>
    <script src="js/camera.js"></script>
    <script src="js/director.js"></script>
  </head>

  <body>
    <div id="canvas_container"></div>

    <p id="debug"></p>

    <br />
    <br />

    <div
      style="position: absolute;right: 10px; top:10px; width:400px;background: #ccc;"
    >
      <ul id="debuglist"></ul>
    </div>
  </body>

  <script>
    "use scrict";

    // DEBUG
    var imageCounter = 0;
    var imgFlag = false;

    // Part 1 (getContext)
    // create canvas and gl(webGL)
    var div = $("canvas_container");
    var canvas = dcE("canvas");
    canvas.className = "default_canvas";
    var title = dcE("div");
    canvas.width = div.offsetWidth;
    canvas.height = div.offsetHeight;
    div.appendChild(canvas);
    title.innerHTML = document.title;
    title.className = "div_footer";
    div.appendChild(title);

    var sphereLight = Geometry.sphere({ radius: 0.5 });

    var terrain = Geometry.terrain({
      radius: 1000,
      rows: 10,
      cols: 10,
      shiftPoints: [
        [0, 0, [0, 224, 0]],
        [1, 0, [0, 162, 0]],
        [2, 0, [0, 324, 0]],
        [3, 0, [0, 320, 0]],
        [4, 0, [0, 188, 0]],
        [5, 0, [0, 199, 0]],
        [6, 0, [0, 250, 0]],
        [7, 0, [0, 81, 0]],
        [8, 0, [0, 213, 0]],
        [9, 0, [0, 206, 0]],
        [10, 0, [0, 121, 0]],
        [0, 1, [0, 165, 0]],
        [1, 1, [0, 90, 0]],
        [6, 1, [0, 56, 0]],
        [7, 1, [4, 74, 56]],
        [8, 1, [8, 55, -60]],
        [9, 1, [0, 33, 0]],
        [10, 1, [0, 156, 0]],
        [0, 2, [0, 129, 0]],
        [1, 2, [0, 70, 0]],
        [2, 2, [60, 1, 40]],
        [3, 2, [20, 0, -24]],
        [4, 2, [28, 0, -20]],
        [6, 2, [52, 0, 24]],
        [7, 2, [60, 0, 0]],
        [8, 2, [0, 121, 0]],
        [9, 2, [-48, 0, 8]],
        [10, 2, [0, 90, 0]],
        [0, 3, [0, 0, 0]],
        [1, 3, [0, 50, 0]],
        [2, 3, [40, 5, -12]],
        [3, 3, [0, 3, 0]],
        [4, 3, [0, 3, 0]],
        [5, 3, [0, 3, 0]],
        [6, 3, [28, 0, 12]],
        [7, 3, [52, 0, 32]],
        [8, 3, [40, 0, 80]],
        [9, 3, [-24, 0, 72]],
        [10, 3, [0, 85, 0]],
        [0, 4, [0, 154, 0]],
        [2, 4, [24, 5, 12]],
        [3, 4, [36, 0, -20]],
        [4, 4, [52, 0, -20]],
        [5, 4, [76, 0, -32]],
        [6, 4, [0, 6, 0]],
        [7, 4, [0, 3, 0]],
        [8, 4, [4, 0, 44]],
        [2, 5, [8, 0, -48]],
        [3, 5, [0, 59, 0]],
        [4, 5, [0, 232, 0]],
        [5, 5, [72, 0, 0]],
        [6, 5, [0, 6, 0]],
        [8, 5, [0, 8, 0]],
        [0, 6, [0, 118, 0]],
        [1, 6, [0, 66, 0]],
        [2, 6, [36, 0, -12]],
        [3, 6, [-8, 132, 32]],
        [4, 6, [0, 272, 0]],
        [5, 6, [56, 0, 12]],
        [1, 7, [0, 51, 0]],
        [2, 7, [68, 0, 0]],
        [3, 7, [0, 77, 0]],
        [4, 7, [0, 158, 0]],
        [5, 7, [32, 0, 12]],
        [7, 7, [0, 8, 0]],
        [2, 8, [112, 0, 24]],
        [3, 8, [40, 0, 36]],
        [4, 8, [4, 0, 52]],
        [5, 8, [8, 0, 88]],
        [1, 9, [0, 16, 0]],
        [3, 9, [0, 5, 0]]
      ],
      rigidities: [
        [3, 2, 0.75],
        [4, 2, 0.6],
        [5, 2, 0.6],
        [6, 2, 0.6],
        [7, 2, 0.9],

        [6, 3, 0.6],
        [7, 3, 0.6],

        [3, 4, 0.9],
        [4, 4, 0.9],
        [6, 4, 0.6],
        [7, 4, 0.6],

        [2, 5, 0.9],
        [3, 5, 0.9],
        [4, 5, 0.9],
        [6, 5, 0.6],
        [7, 5, 0.6],

        [2, 6, 0.9],
        [3, 6, 0.9],
        [4, 6, 0.9],
        [6, 6, 0.6],
        [7, 6, 0.6]
      ]
    });

    var director = new DirectorController(canvas);

    var camera1 = new Camera();
    camera1.type = CameraKind.LOOKAT;
    camera1.dynamic.position = [0, 1.5, -5];
    camera1.dynamic.lookAt = [0, 1, 0];
    camera1.far = 2600;

    var surface = new PropService({
      image: "misc/golfplane.jpg",
      geometry: terrain,
      position: [0, 0, 0],
      physics: {
        movable: false,
        rigidity: 0.3
      }
    });

    var light1 = new LightService();
    light1.setKind(LightKind.DIRECT);
    light1.setDirection([-0, -0.9, -0.0]);

    var light2 = new LightService();
    light2.setKind(LightKind.POINT);
    light2.position = [300, 1000, 500];
    propLight = new PropService({
      geometry: sphereLight,
      color: [1, 1, 1, 1],
      position: light2.position
    });

    var propC = [];
    propC.push(surface);
    propC.push(propLight);

    var scene = new SceneService(propC, [light1, light2], [camera1]);

    director.addScene([scene]);

    director.action();

    var time = 0;
    function rotateCamera() {
      var t = time / 5000;
      if (t > Math.abs(Math.PI * 2)) time = 0;
      var r = 1500;
      var x = r * Math.sin(t);
      var z = r * Math.cos(t);
      camera1.dynamic.position = [x, 900, z];
      time += 40;
      setTimeout("rotateCamera()", 40);
    }
    rotateCamera();
  </script>
</html>
