<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Kamera mit Math.js</title>
    <link href="css/style.css" rel="stylesheet" />
    <script src="js/gl.js"></script>
    <script src="js/geometry.js"></script>
    <script src="js/physics.js"></script>
    <script src="js/math.js"></script>
    <script src="js/functions.js"></script>
    <script src="js/attribute.js"></script>
    <script src="js/uniform.js"></script>
    <script src="js/texture.js"></script>
    <script src="js/program.js"></script>
    <script src="js/baseobject.js"></script>
    <script src="js/triangle.js"></script>
    <script src="js/dynamic.js"></script>
    <script src="js/item.js"></script>
    <script src="js/scene.js"></script>
    <script src="js/vertexshader.js"></script>
    <script src="js/fragmentshader.js"></script>
    <script src="js/world.js"></script>
    <script src="js/prop.js"></script>
    <script src="js/light.js"></script>
    <script src="js/camera.js"></script>
    <script src="js/director.js"></script>
  </head>

  <body>
    <div id="canvas_container"></div>

    <p id="debug"></p>

    Cube<br />
    <button onclick="acceleration(0,-9.81,0)">Gravity</button>
    <br />
    <br />
    Moon<br />
    <button onclick="rotateProp1(-0.05,0,0)">Rotate -X</button>
    <button onclick="rotateProp1(+0.05,0,0)">Rotate +X</button>
    <br />
    <button onclick="rotateProp1(0,-0.05,0)">Rotate -Y</button>
    <button onclick="rotateProp1(0,+0.05,0)">Rotate +Y</button>
    <br />
    <button onclick="rotateProp1(0,0,-0.05)">Rotate -Z</button>
    <button onclick="rotateProp1(0,0,+0.05)">Rotate +Z</button>
    <br />

    <br />
    <br />
    Pointlight<br />

    <div class="slidecontainer">
      X position
      <input
        type="range"
        min="-4"
        max="4"
        value="1"
        class="slider"
        id="lightX"
        onchange="lightPos();"
        oninput="lightPos();"
      />
      <br />
      Y position
      <input
        type="range"
        min="-3"
        max="3"
        value="3"
        class="slider"
        id="lightY"
        onchange="lightPos();"
        oninput="lightPos();"
      />
      Z position
      <input
        type="range"
        min="-5"
        max="5"
        value="0"
        class="slider"
        id="lightZ"
        onchange="lightPos();"
        oninput="lightPos();"
      />
    </div>

    <div
      style="position: absolute;right: 10px; top:10px; width:400px;background: #ccc;"
    >
      <ul id="debuglist"></ul>
    </div>
  </body>

  <script>
    "use scrict";

    // DEBUG
    var imageCounter = 0;
    var imgFlag = false;

    // Part 1 (getContext)
    // create canvas and gl(webGL)
    var div = $("canvas_container");
    var canvas = dcE("canvas");
    canvas.className = "default_canvas";
    var title = dcE("div");
    canvas.width = div.offsetWidth;
    canvas.height = div.offsetHeight;
    div.appendChild(canvas);
    title.innerHTML = document.title;
    title.className = "div_footer";
    div.appendChild(title);

    var cube = Geometry.cube({ radius: 20 });
    var sphere = Geometry.sphere({ radius: 0.05, stacks: 8, slices: 8 });
    var sphereLight = Geometry.sphere({ radius: 0.5 });
    var plane = Geometry.plane({ radius: 1.4 });
    var plane2 = Geometry.plane({ radius: 0.2 });
    var plane3 = Geometry.plane({ radius: 0.2 });
    var terrain = Geometry.terrain({
      radius: 3,
      rows: 3,
      cols: 3,
      shiftPoints: [[1, 1, [-1, 1.4, 1]]]
      // shiftPoints:[
      //   [2,4,[0,0.4,0]],[3,4,[0,0.3,0]],
      //   [2,5,[0,0.8,0]],[3,5,[0,0.6,0]],
      //   [2,6,[0,0.6,0]],[3,6,[0,0.4,0]],
      //   [2,7,[0,0.1,0]],[3,7,[0,0.2,0]],
      //  ]
    });

    var director = new DirectorController(canvas);

    var camera1 = new Camera();
    camera1.type = CameraKind.LOOKAT;
    camera1.dynamic.position = [0, 1.5, -5];
    camera1.dynamic.lookAt = [0, 1, 0];

    var ball9 = new PropService({
      geometry: sphere,
      image: "misc/9ball.jpg",
      position: [-0.6, 1.8, 0],
      shininess: 20,
      physics: { movable: true, rigidity: 0.9, weight: 0.2, id: 1 }
    });
    ball9.dynamic.id = 1;

    var surface = new PropService({
      //color:[0.8,0.68,0.1,1],
      image: "misc/golfplane.jpg",
      geometry: terrain,
      position: [0, 0, 0],
      physics: { movable: false, rigidity: 0.9 }
    });

    // var surface = new PropService({
    //   color:[0.8,0.68,0.1,1],
    //   geometry:terrain,
    //   position: [0,0,0],
    //   physics:{movable:false,rigidity:0.9}
    // });

    var ball9a = new PropService({
      geometry: sphere,
      image: "misc/9ball.jpg",
      position: [0.7, 1.8, 0.1],
      shininess: 20,
      physics: { movable: true, rigidity: 0.9, weight: 0.2, id: 2 }
    });

    var ball9b = new PropService({
      geometry: sphere,
      image: "misc/9ball.jpg",
      position: [-0.0, 1.05, 0.02],
      shininess: 20,
      physics: { movable: true, rigidity: 0.9, weight: 0.2, id: 3 }
    });

    var light1 = new LightService();
    light1.setKind(LightKind.DIRECT);
    light1.setDirection([-0, -0.9, -0.0]);

    var light2 = new LightService();
    light2.setKind(LightKind.POINT);
    light2.position = [1, 1.5, 1];
    propLight = new PropService({
      geometry: sphereLight,
      color: [1, 1, 1, 1],
      position: light2.position
    });

    var propC = [];
    propC.push(surface);
    propC.push(ball9);
    propC.push(ball9a);
    propC.push(ball9b);
    propC.push(propLight);

    var scene = new SceneService(propC, [light1, light2], [camera1]);

    director.addScene([scene]);

    director.action();

    function rotate(valueX, valueY, valueZ) {
      ball14.dynamic.rotate = [valueX, valueY, valueZ];
    }

    function rotateProp1(valueX, valueY, valueZ) {
      ball9.dynamic.rotate = [valueX, valueY, valueZ];
    }

    function acceleration(valueX, valueY, valueZ) {
      ball9.dynamic.acceleration = [valueX, valueY, valueZ];
      ball9a.dynamic.acceleration = [valueX, valueY, valueZ];
      ball9b.dynamic.acceleration = [valueX, valueY, valueZ];
      imgFlag = true;
    }

    function lightPos() {
      var valueX = $("lightX").value;
      var valueY = $("lightY").value;
      var valueZ = $("lightZ").value;
      light2.dynamic.position = [valueX, valueY, valueZ];
      propLight.dynamic.position = [valueX, valueY, valueZ];
    }
    lightPos();

    var time = 0;
    function rotateCamera() {
      var t = time / 5000;
      if (t > Math.abs(Math.PI * 2)) time = 0;
      var r = 5;
      var x = r * Math.sin(t);
      var z = r * Math.cos(t);
      camera1.dynamic.position = [x, 6, z];
      time += 40;
      setTimeout("rotateCamera()", 40);
    }
    rotateCamera();
  </script>
</html>
